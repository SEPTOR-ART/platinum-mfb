<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platinum MFB - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .admin-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .card-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
        }
        .badge {
            font-size: 0.8em;
        }
        .table th {
            background-color: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        .stats-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-shield-alt me-3"></i>Platinum MFB Admin Dashboard</h1>
                    <p class="mb-0">View all submitted forms and customer applications</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light btn-lg" onclick="refreshData()">
                        <i class="fas fa-sync-alt me-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="row mb-4" id="stats-container">
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-number" id="accounts-count">-</div>
                    <div class="stats-label">Account Applications</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-number" id="contacts-count">-</div>
                    <div class="stats-label">Contact Messages</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="loans-count">-</div>
                    <div class="stats-label">Loan Applications</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="investments-count">-</div>
                    <div class="stats-label">Investment Applications</div>
                </div>
            </div>
        </div>

        <!-- Account Applications -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-user-plus me-2"></i>Account Applications</h3>
            </div>
            <div class="card-body">
                <div id="accounts-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading account applications...
                </div>
                <div id="accounts-content" style="display: none;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Account Type</th>
                                    <th>Initial Deposit</th>
                                    <th>Occupation</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="accounts-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="accounts-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Account Applications Yet</h4>
                    <p>Account applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Contact Messages -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-envelope me-2"></i>Contact Messages</h3>
            </div>
            <div class="card-body">
                <div id="contacts-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading contact messages...
                </div>
                <div id="contacts-content" style="display: none;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Subject</th>
                                    <th>Message</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="contacts-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Contact Messages Yet</h4>
                    <p>Contact messages will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Loan Applications -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-hand-holding-usd me-2"></i>Loan Applications</h3>
            </div>
            <div class="card-body">
                <div id="loans-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading loan applications...
                </div>
                <div id="loans-content" style="display: none;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Amount</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="loans-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="loans-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Loan Applications Yet</h4>
                    <p>Loan applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Investment Applications -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-chart-line me-2"></i>Investment Applications</h3>
            </div>
            <div class="card-body">
                <div id="investments-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading investment applications...
                </div>
                <div id="investments-content" style="display: none;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Investment Type</th>
                                    <th>Amount</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="investments-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="investments-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Investment Applications Yet</h4>
                    <p>Investment applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });

        async function loadAllData() {
            await Promise.all([
                loadAccounts(),
                loadContacts(),
                loadLoans(),
                loadInvestments()
            ]);
            updateStats();
        }

        async function loadAccounts() {
            try {
                const response = await fetch('https://platinum-mfb.onrender.com/api/admin/accounts');
                const accounts = await response.json();
                displayAccounts(accounts);
            } catch (error) {
                console.error('Error loading accounts:', error);
                document.getElementById('accounts-loading').style.display = 'none';
                document.getElementById('accounts-empty').style.display = 'block';
            }
        }

        async function loadContacts() {
            try {
                const response = await fetch('https://platinum-mfb.onrender.com/api/admin/contacts');
                const contacts = await response.json();
                displayContacts(contacts);
            } catch (error) {
                console.error('Error loading contacts:', error);
                document.getElementById('contacts-loading').style.display = 'none';
                document.getElementById('contacts-empty').style.display = 'block';
            }
        }

        async function loadLoans() {
            try {
                const response = await fetch('https://platinum-mfb.onrender.com/api/admin/loans');
                const loans = await response.json();
                displayLoans(loans);
            } catch (error) {
                console.error('Error loading loans:', error);
                document.getElementById('loans-loading').style.display = 'none';
                document.getElementById('loans-empty').style.display = 'block';
            }
        }

        async function loadInvestments() {
            try {
                const response = await fetch('https://platinum-mfb.onrender.com/api/admin/investment-applications');
                const investments = await response.json();
                displayInvestments(investments);
            } catch (error) {
                console.error('Error loading investments:', error);
                document.getElementById('investments-loading').style.display = 'none';
                document.getElementById('investments-empty').style.display = 'block';
            }
        }

        function displayAccounts(accounts) {
            const container = document.getElementById('accounts-table');
            const loading = document.getElementById('accounts-loading');
            const content = document.getElementById('accounts-content');
            const empty = document.getElementById('accounts-empty');

            loading.style.display = 'none';

            if (accounts.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = accounts.map(account => `
                <tr>
                    <td>${account.full_name}</td>
                    <td>${account.email}</td>
                    <td>${account.phone}</td>
                    <td><span class="badge bg-primary">${account.account_type.replace('-', ' ')}</span></td>
                    <td>₦${Number(account.initial_deposit).toLocaleString()}</td>
                    <td>${account.occupation}</td>
                    <td><span class="badge bg-${getStatusColor(account.status)}">${account.status}</span></td>
                    <td>${new Date(account.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        function displayContacts(contacts) {
            const container = document.getElementById('contacts-table');
            const loading = document.getElementById('contacts-loading');
            const content = document.getElementById('contacts-content');
            const empty = document.getElementById('contacts-empty');

            loading.style.display = 'none';

            if (contacts.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = contacts.map(contact => `
                <tr>
                    <td>${contact.name}</td>
                    <td>${contact.email}</td>
                    <td><span class="badge bg-info">${contact.subject.replace('-', ' ')}</span></td>
                    <td>${contact.message.length > 50 ? contact.message.substring(0, 50) + '...' : contact.message}</td>
                    <td><span class="badge bg-${getStatusColor(contact.status)}">${contact.status}</span></td>
                    <td>${new Date(contact.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        function displayLoans(loans) {
            const container = document.getElementById('loans-table');
            const loading = document.getElementById('loans-loading');
            const content = document.getElementById('loans-content');
            const empty = document.getElementById('loans-empty');

            loading.style.display = 'none';

            if (loans.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = loans.map(loan => `
                <tr>
                    <td>${loan.full_name}</td>
                    <td>${loan.email}</td>
                    <td>₦${Number(loan.amount).toLocaleString()}</td>
                    <td>${loan.purpose}</td>
                    <td><span class="badge bg-${getStatusColor(loan.status)}">${loan.status}</span></td>
                    <td>${new Date(loan.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        function displayInvestments(investments) {
            const container = document.getElementById('investments-table');
            const loading = document.getElementById('investments-loading');
            const content = document.getElementById('investments-content');
            const empty = document.getElementById('investments-empty');

            loading.style.display = 'none';

            if (investments.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = investments.map(investment => `
                <tr>
                    <td>${investment.full_name}</td>
                    <td>${investment.email}</td>
                    <td><span class="badge bg-info">${investment.investment_type.replace('-', ' ')}</span></td>
                    <td>₦${Number(investment.amount).toLocaleString()}</td>
                    <td>${investment.duration.replace('-', ' ')}</td>
                    <td><span class="badge bg-${getStatusColor(investment.status)}">${investment.status}</span></td>
                    <td>${new Date(investment.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'approved': return 'success';
                case 'rejected': return 'danger';
                case 'new': return 'primary';
                case 'in-progress': return 'info';
                case 'resolved': return 'success';
                default: return 'secondary';
            }
        }

        function updateStats() {
            const accountsCount = document.querySelectorAll('#accounts-table tr').length;
            const contactsCount = document.querySelectorAll('#contacts-table tr').length;
            const loansCount = document.querySelectorAll('#loans-table tr').length;
            const investmentsCount = document.querySelectorAll('#investments-table tr').length;

            document.getElementById('accounts-count').textContent = accountsCount;
            document.getElementById('contacts-count').textContent = contactsCount;
            document.getElementById('loans-count').textContent = loansCount;
            document.getElementById('investments-count').textContent = investmentsCount;
        }

        function refreshData() {
            // Reset all loading states
            document.getElementById('accounts-loading').style.display = 'block';
            document.getElementById('contacts-loading').style.display = 'block';
            document.getElementById('loans-loading').style.display = 'block';
            document.getElementById('investments-loading').style.display = 'block';
            
            document.getElementById('accounts-content').style.display = 'none';
            document.getElementById('contacts-content').style.display = 'none';
            document.getElementById('loans-content').style.display = 'none';
            document.getElementById('investments-content').style.display = 'none';
            
            document.getElementById('accounts-empty').style.display = 'none';
            document.getElementById('contacts-empty').style.display = 'none';
            document.getElementById('loans-empty').style.display = 'none';
            document.getElementById('investments-empty').style.display = 'none';

            loadAllData();
        }
    </script>
</body>
</html>
