<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platinum MFB - Admin Dashboard</title>
    
    <!-- SEO and Security Meta Tags -->
    <meta name="description" content="Platinum Microfinance Bank - Secure Admin Dashboard for managing customer applications and website analytics">
    <meta name="keywords" content="Platinum MFB, Admin, Dashboard, Banking, Security">
    <meta name="author" content="Platinum Microfinance Bank Limited">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="theme-color" content="#28a745">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Platinum MFB - Admin Dashboard">
    <meta property="og:description" content="Secure Admin Dashboard for Platinum Microfinance Bank">
    <meta property="og:url" content="https://platinum-mfb.netlify.app/admin.html">
    <meta property="og:site_name" content="Platinum Microfinance Bank">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Platinum MFB - Admin Dashboard">
    <meta name="twitter:description" content="Secure Admin Dashboard for Platinum Microfinance Bank">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/logo.png">
    <link rel="apple-touch-icon" href="assets/images/logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; img-src 'self' data: https: blob:; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self' https://platinum-mfb.onrender.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; media-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), speaker=(), vibrate=(), fullscreen=(self), sync-xhr=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-DNS-Prefetch-Control" content="off">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Resource-Policy" content="same-origin">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, private">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .admin-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .card-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
        }
        .badge {
            font-size: 0.8em;
        }
        .table th {
            background-color: #f8f9fa;
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        .stats-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .stats-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .analytics-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        .analytics-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }
        .analytics-content h4 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        .analytics-content p {
            margin: 0 0 0.5rem 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .analytics-trend {
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .analytics-trend i {
            margin-right: 0.25rem;
        }
        
        /* Analytics Card Color Variants */
        .analytics-primary .analytics-icon {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        
        .analytics-success .analytics-icon {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }
        
        .analytics-info .analytics-icon {
            background: linear-gradient(135deg, #17a2b8, #117a8b);
            color: white;
        }
        
        .analytics-warning .analytics-icon {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: white;
        }
        .activity-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .activity-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        .activity-item i {
            margin-right: 0.5rem;
            font-size: 0.8rem;
        }
        .traffic-sources {
            max-height: 200px;
            overflow-y: auto;
        }
        .traffic-item {
            margin-bottom: 1rem;
        }
        .traffic-label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: #333;
        }
        .progress {
            height: 20px;
            border-radius: 10px;
        }
        
        /* Enhanced Admin Header Styles */
        .admin-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .admin-logo {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            backdrop-filter: blur(10px);
        }
        
        .admin-subtitle {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .admin-actions .btn {
            border-radius: 25px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .admin-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Enhanced Stats Cards */
        .stats-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--bs-primary), var(--bs-success));
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #28a745, #20c997);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats-icon {
            font-size: 2rem;
            opacity: 0.8;
        }
        
        .stats-card.bg-primary .stats-icon {
            color: #fff;
        }
        
        .stats-card.bg-secondary .stats-icon {
            color: #fff;
        }
        
        .stats-card.bg-success .stats-icon {
            color: #fff;
        }
        
        .stats-card.bg-info .stats-icon {
            color: #fff;
        }
        
        .stats-card.bg-warning .stats-icon {
            color: #fff;
        }
        
        .stats-card.bg-dark .stats-icon {
            color: #fff;
        }
        
        /* Enhanced Table Styles */
        .table {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 0;
        }
        
        .table thead th {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: none;
            font-weight: 600;
            color: #495057;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .table tbody tr {
            transition: all 0.2s ease;
        }
        
        .table tbody tr:hover {
            background-color: rgba(40, 167, 69, 0.05);
            transform: scale(1.01);
        }
        
        .table tbody td {
            padding: 1rem;
            border-color: rgba(0,0,0,0.05);
        }
        
        /* Scrollable Table Container */
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-radius: 10px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #1e7e34, #17a2b8);
        }
        
        /* Custom scrollbar for activity list */
        .activity-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .activity-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .activity-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-radius: 10px;
        }
        
        .activity-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #1e7e34, #17a2b8);
        }
        
        /* Smooth scrolling behavior */
        .table-container, .activity-list {
            scroll-behavior: smooth;
        }
        
        /* Add subtle shadow to indicate scrollable content */
        .table-container {
            position: relative;
        }
        
        .table-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, rgba(248,249,250,0.8));
            pointer-events: none;
            border-radius: 0 0 10px 10px;
        }
        
        /* Enhanced Badge Styles */
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8rem;
        }
        
        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }
        
        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .no-data {
            text-align: center;
            padding: 4rem;
            color: #6c757d;
        }
        
        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* Enhanced Card Styles */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }
        
        .card-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
            padding: 1.5rem;
        }
        
        .card-header h3 {
            margin: 0;
            font-weight: 600;
        }
        
        /* Search and Filter Styles */
        .admin-search input {
            border-radius: 25px;
            border: 2px solid #e9ecef;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .admin-search input:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
            background: white;
        }
        
        .admin-search input::placeholder {
            color: #6c757d;
            font-style: italic;
        }
        
        /* Search result counter */
        .search-counter {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .search-counter.highlight {
            color: #28a745;
            font-weight: 500;
        }
        
        /* Responsive Improvements */
        @media (max-width: 768px) {
            .admin-header {
                padding: 1.5rem 0;
            }
            
            .admin-logo {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .admin-actions .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            
            .stats-card {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .stats-number {
                font-size: 2rem;
            }
            
            .admin-search input {
                width: 100% !important;
                margin-top: 1rem;
            }
            
            .d-flex.justify-content-between {
                flex-direction: column;
                align-items: flex-start !important;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <div class="admin-logo me-3">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <h1 class="mb-1">Platinum MFB Admin Dashboard</h1>
                            <p class="mb-0 admin-subtitle">Secure Management Portal for Customer Applications & Analytics</p>
                            <small class="opacity-75">
                                <i class="fas fa-clock me-1"></i>
                                Last Updated: <span id="last-updated">Loading...</span>
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="admin-actions">
                        <div class="btn-group me-2" role="group">
                            <button class="btn btn-light btn-sm" onclick="refreshData()" title="Refresh All Data">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-light btn-sm" onclick="exportData()" title="Export Data">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-light btn-sm" onclick="toggleAutoRefresh()" title="Toggle Auto-Refresh" id="auto-refresh-btn">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        <button class="btn btn-outline-light btn-sm me-2" onclick="clearAllSearches()" title="Clear All Searches">
                            <i class="fas fa-search-minus me-1"></i>Clear
                        </button>
                        <button class="btn btn-outline-light btn-sm me-2" onclick="showSettings()" title="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn btn-outline-light btn-sm" onclick="logout()" title="Logout">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="row mb-4" id="stats-container">
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-primary">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="total-visits">-</div>
                            <div class="stats-label">Total Visits</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-secondary">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="unique-visitors">-</div>
                            <div class="stats-label">Unique Visitors</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-success">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="accounts-count">-</div>
                            <div class="stats-label">Account Apps</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-info">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="contacts-count">-</div>
                            <div class="stats-label">Messages</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-warning">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="loans-count">-</div>
                            <div class="stats-label">Loan Apps</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                <div class="stats-card bg-dark">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <div class="stats-number" id="investments-count">-</div>
                            <div class="stats-label">Investments</div>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Website Analytics -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Website Performance Analytics</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="analytics-card analytics-primary">
                            <div class="analytics-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="analytics-content">
                                <h4 id="page-views">0</h4>
                                <p>Page Views Today</p>
                                <div class="analytics-trend">
                                    <i class="fas fa-arrow-up text-success"></i>
                                    <span class="text-success">+12%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="analytics-card analytics-success">
                            <div class="analytics-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="analytics-content">
                                <h4 id="avg-session-time">0s</h4>
                                <p>Avg Session Time</p>
                                <div class="analytics-trend">
                                    <i class="fas fa-arrow-up text-success"></i>
                                    <span class="text-success">+8%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="analytics-card analytics-info">
                            <div class="analytics-icon">
                                <i class="fas fa-mouse-pointer"></i>
                            </div>
                            <div class="analytics-content">
                                <h4 id="conversion-rate">0%</h4>
                                <p>Conversion Rate</p>
                                <div class="analytics-trend">
                                    <i class="fas fa-arrow-up text-success"></i>
                                    <span class="text-success">+5%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="analytics-card analytics-warning">
                            <div class="analytics-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="analytics-content">
                                <h4 id="top-page">Home</h4>
                                <p>Most Visited Page</p>
                                <div class="analytics-trend">
                                    <i class="fas fa-chart-line text-info"></i>
                                    <span class="text-info">Popular</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5><i class="fas fa-calendar-week me-2"></i>Recent Activity (Last 7 Days)</h5>
                        <div id="recent-activity" class="activity-list" style="max-height: 200px; overflow-y: auto;">
                            <div class="activity-item">
                                <i class="fas fa-circle text-success"></i>
                                <span>Loading recent activity...</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-chart-pie me-2"></i>Traffic Sources</h5>
                        <div id="traffic-sources" class="traffic-sources">
                            <div class="traffic-item">
                                <span class="traffic-label">Direct</span>
                                <div class="progress">
                                    <div class="progress-bar bg-primary" style="width: 60%">60%</div>
                                </div>
                            </div>
                            <div class="traffic-item">
                                <span class="traffic-label">Google</span>
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: 25%">25%</div>
                                </div>
                            </div>
                            <div class="traffic-item">
                                <span class="traffic-label">Social Media</span>
                                <div class="progress">
                                    <div class="progress-bar bg-info" style="width: 10%">10%</div>
                                </div>
                            </div>
                            <div class="traffic-item">
                                <span class="traffic-label">Referral</span>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: 5%">5%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions & System Status -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" onclick="exportData()">
                                    <i class="fas fa-file-export fa-2x mb-2"></i>
                                    <span>Export Data</span>
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" onclick="refreshData()">
                                    <i class="fas fa-sync-alt fa-2x mb-2"></i>
                                    <span>Refresh All</span>
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" onclick="showSystemLogs()">
                                    <i class="fas fa-clipboard-list fa-2x mb-2"></i>
                                    <span>View Logs</span>
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3" onclick="showSettings()">
                                    <i class="fas fa-cog fa-2x mb-2"></i>
                                    <span>Settings</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="mb-0"><i class="fas fa-server me-2"></i>System Status</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>Database Connection</span>
                            <span class="badge bg-success" id="db-status">
                                <i class="fas fa-check-circle me-1"></i>Connected
                            </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>API Server</span>
                            <span class="badge bg-success" id="api-status">
                                <i class="fas fa-check-circle me-1"></i>Online
                            </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>Website Uptime</span>
                            <span class="badge bg-info" id="uptime-status">
                                <i class="fas fa-clock me-1"></i>99.9%
                            </span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>Security Status</span>
                            <span class="badge bg-success" id="security-status">
                                <i class="fas fa-shield-alt me-1"></i>Secure
                            </span>
                        </div>
                        <hr>
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Last health check: <span id="health-check-time">Just now</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Applications -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-user-plus me-2"></i>Account Applications</h3>
                    <div class="admin-search">
                        <input type="text" id="accounts-search" class="form-control" placeholder="Search accounts..." style="width: 250px;">
                        <div id="accounts-counter" class="search-counter"></div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="accounts-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading account applications...
                </div>
                <div id="accounts-content" style="display: none;">
                    <div class="table-responsive table-container">
                        <table class="table table-hover" id="accounts-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Account Type</th>
                                    <th>Initial Deposit</th>
                                    <th>Occupation</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="accounts-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="accounts-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Account Applications Yet</h4>
                    <p>Account applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Contact Messages -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-envelope me-2"></i>Contact Messages</h3>
                    <div class="admin-search">
                        <input type="text" id="contacts-search" class="form-control" placeholder="Search contacts..." style="width: 250px;">
                        <div id="contacts-counter" class="search-counter"></div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="contacts-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading contact messages...
                </div>
                <div id="contacts-content" style="display: none;">
                    <div class="table-responsive table-container">
                        <table class="table table-hover" id="contacts-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Subject</th>
                                    <th>Message</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="contacts-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Contact Messages Yet</h4>
                    <p>Contact messages will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Loan Applications -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-hand-holding-usd me-2"></i>Loan Applications</h3>
                    <div class="admin-search">
                        <input type="text" id="loans-search" class="form-control" placeholder="Search loans..." style="width: 250px;">
                        <div id="loans-counter" class="search-counter"></div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="loans-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading loan applications...
                </div>
                <div id="loans-content" style="display: none;">
                    <div class="table-responsive table-container">
                        <table class="table table-hover" id="loans-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Amount</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="loans-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="loans-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Loan Applications Yet</h4>
                    <p>Loan applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>

        <!-- Investment Applications -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0"><i class="fas fa-chart-line me-2"></i>Investment Applications</h3>
                    <div class="admin-search">
                        <input type="text" id="investments-search" class="form-control" placeholder="Search investments..." style="width: 250px;">
                        <div id="investments-counter" class="search-counter"></div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="investments-loading" class="loading">
                    <i class="fas fa-spinner fa-spin me-2"></i>Loading investment applications...
                </div>
                <div id="investments-content" style="display: none;">
                    <div class="table-responsive table-container">
                        <table class="table table-hover" id="investments-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Investment Type</th>
                                    <th>Amount</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="investments-table">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="investments-empty" class="no-data" style="display: none;">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Investment Applications Yet</h4>
                    <p>Investment applications will appear here once customers submit them.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="cookie-banner.js"></script>
    <script>
        // Load data when page loads
        // Enhanced search functionality for all tables
        function setupSearch() {
            // Accounts search
            const accountsSearchInput = document.getElementById('accounts-search');
            if (accountsSearchInput) {
                accountsSearchInput.addEventListener('input', function() {
                    performSearch('#accounts-table', '#accounts-counter', this.value);
                });
            }

            // Contacts search
            const contactsSearchInput = document.getElementById('contacts-search');
            if (contactsSearchInput) {
                contactsSearchInput.addEventListener('input', function() {
                    performSearch('#contacts-table', '#contacts-counter', this.value);
                });
            }

            // Loans search
            const loansSearchInput = document.getElementById('loans-search');
            if (loansSearchInput) {
                loansSearchInput.addEventListener('input', function() {
                    performSearch('#loans-table', '#loans-counter', this.value);
                });
            }

            // Investments search
            const investmentsSearchInput = document.getElementById('investments-search');
            if (investmentsSearchInput) {
                investmentsSearchInput.addEventListener('input', function() {
                    performSearch('#investments-table', '#investments-counter', this.value);
                });
            }
        }

        // Enhanced search function with counters and highlighting
        function performSearch(tableSelector, counterSelector, searchTerm) {
            const searchLower = searchTerm.toLowerCase().trim();
            const rows = document.querySelectorAll(`${tableSelector} tbody tr`);
            const counter = document.querySelector(counterSelector);
            
            let visibleCount = 0;
            let totalCount = rows.length;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const isVisible = searchLower === '' || text.includes(searchLower);
                
                row.style.display = isVisible ? '' : 'none';
                if (isVisible) visibleCount++;
                
                // Add highlighting for search terms
                if (searchLower && isVisible) {
                    highlightSearchTerm(row, searchTerm);
                } else {
                    removeHighlighting(row);
                }
            });
            
            // Update counter
            if (counter) {
                if (searchLower === '') {
                    counter.textContent = `${totalCount} total records`;
                    counter.className = 'search-counter';
                } else {
                    counter.textContent = `${visibleCount} of ${totalCount} records match "${searchTerm}"`;
                    counter.className = visibleCount > 0 ? 'search-counter highlight' : 'search-counter';
                }
            }
        }

        // Highlight search terms in table rows
        function highlightSearchTerm(row, searchTerm) {
            const cells = row.querySelectorAll('td');
            cells.forEach(cell => {
                const originalText = cell.textContent;
                if (originalText.toLowerCase().includes(searchTerm.toLowerCase())) {
                    const regex = new RegExp(`(${searchTerm})`, 'gi');
                    const highlightedText = originalText.replace(regex, '<mark style="background-color: #fff3cd; padding: 2px 4px; border-radius: 3px;">$1</mark>');
                    cell.innerHTML = highlightedText;
                }
            });
        }

        // Remove highlighting from table rows
        function removeHighlighting(row) {
            const cells = row.querySelectorAll('td');
            cells.forEach(cell => {
                if (cell.innerHTML !== cell.textContent) {
                    cell.innerHTML = cell.textContent;
                }
            });
        }

        // Clear all search fields
        function clearAllSearches() {
            const searchInputs = [
                'accounts-search',
                'contacts-search', 
                'loans-search',
                'investments-search'
            ];
            
            searchInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.value = '';
                    input.dispatchEvent(new Event('input'));
                }
            });
        }
        
        // Check authentication status
        function checkAuthStatus() {
            const token = localStorage.getItem('admin_token');
            const expires = localStorage.getItem('admin_expires');
            
            if (!token || !expires || new Date() >= new Date(expires)) {
                // Not authenticated, redirect to login
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }

        // Verify token with server
        async function verifyToken() {
            const token = localStorage.getItem('admin_token');
            
            try {
                const response = await fetch('https://platinum-mfb.onrender.com/api/admin/verify', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    // Token invalid, redirect to login
                    localStorage.removeItem('admin_token');
                    localStorage.removeItem('admin_expires');
                    localStorage.removeItem('admin_username');
                    window.location.href = 'login.html';
                    return false;
                }
                
                const data = await response.json();
                console.log('Authenticated as:', data.user.username);
                return true;
                
            } catch (error) {
                console.error('Token verification error:', error);
                // Network error, redirect to login for security
                localStorage.removeItem('admin_token');
                localStorage.removeItem('admin_expires');
                localStorage.removeItem('admin_username');
                window.location.href = 'login.html';
                return false;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_expires');
            localStorage.removeItem('admin_username');
            window.location.href = 'login.html';
        }

        document.addEventListener('DOMContentLoaded', async function() {
            // Check authentication first
            if (!checkAuthStatus()) {
                return;
            }
            
            // Verify token with server
            const isAuthenticated = await verifyToken();
            if (!isAuthenticated) {
                return;
            }
            
            // Load data and setup search
            loadAllData();
            setupSearch();
        });

        async function loadAllData() {
            // Load analytics data first
            loadAnalyticsData();
            updateAnalytics();
            
            // Load data sequentially to reduce server load
            try {
                await loadAccounts();
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between requests
                
                await loadContacts();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await loadLoans();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await loadInvestments();
                
                updateStats();
                
                // Track this admin page visit
                trackVisit();
            } catch (error) {
                console.error('Error loading data:', error);
                updateStats(); // Still update stats even if some data fails to load
            }
        }

        async function loadAccounts() {
            try {
                // Add retry logic for failed requests
                let response;
                let retries = 3;
                
                while (retries > 0) {
                    try {
                        const token = localStorage.getItem('admin_token');
                        response = await fetch('https://platinum-mfb.onrender.com/api/admin/accounts', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            mode: 'cors'
                        });
                        break;
                    } catch (fetchError) {
                        retries--;
                        if (retries === 0) throw fetchError;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second before retry
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const accounts = await response.json();
                displayAccounts(Array.isArray(accounts) ? accounts : []);
            } catch (error) {
                console.error('Error loading accounts:', error);
                document.getElementById('accounts-loading').style.display = 'none';
                document.getElementById('accounts-empty').style.display = 'block';
            }
        }

        async function loadContacts() {
            try {
                // Add retry logic for failed requests
                let response;
                let retries = 3;
                
                while (retries > 0) {
                    try {
                        const token = localStorage.getItem('admin_token');
                        response = await fetch('https://platinum-mfb.onrender.com/api/admin/contacts', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            mode: 'cors'
                        });
                        break;
                    } catch (fetchError) {
                        retries--;
                        if (retries === 0) throw fetchError;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second before retry
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const contacts = await response.json();
                displayContacts(Array.isArray(contacts) ? contacts : []);
            } catch (error) {
                console.error('Error loading contacts:', error);
                document.getElementById('contacts-loading').style.display = 'none';
                document.getElementById('contacts-empty').style.display = 'block';
            }
        }

        async function loadLoans() {
            try {
                // Add retry logic for failed requests
                let response;
                let retries = 3;
                
                while (retries > 0) {
                    try {
                        const token = localStorage.getItem('admin_token');
                        response = await fetch('https://platinum-mfb.onrender.com/api/admin/loans', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            mode: 'cors'
                        });
                        break;
                    } catch (fetchError) {
                        retries--;
                        if (retries === 0) throw fetchError;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second before retry
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const loans = await response.json();
                displayLoans(Array.isArray(loans) ? loans : []);
            } catch (error) {
                console.error('Error loading loans:', error);
                document.getElementById('loans-loading').style.display = 'none';
                document.getElementById('loans-empty').style.display = 'block';
            }
        }

        async function loadInvestments() {
            try {
                // Add retry logic for failed requests
                let response;
                let retries = 3;
                
                while (retries > 0) {
                    try {
                        const token = localStorage.getItem('admin_token');
                        response = await fetch('https://platinum-mfb.onrender.com/api/admin/investment-applications', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            mode: 'cors'
                        });
                        break;
                    } catch (fetchError) {
                        retries--;
                        if (retries === 0) throw fetchError;
                        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second before retry
                    }
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const investments = await response.json();
                displayInvestments(Array.isArray(investments) ? investments : []);
            } catch (error) {
                console.error('Error loading investments:', error);
                document.getElementById('investments-loading').style.display = 'none';
                document.getElementById('investments-empty').style.display = 'block';
            }
        }

        function displayAccounts(accounts) {
            const container = document.getElementById('accounts-table');
            const loading = document.getElementById('accounts-loading');
            const content = document.getElementById('accounts-content');
            const empty = document.getElementById('accounts-empty');

            loading.style.display = 'none';

            if (accounts.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = accounts.map(account => `
                <tr>
                    <td>${account.full_name}</td>
                    <td>${account.email}</td>
                    <td>${account.phone}</td>
                    <td><span class="badge bg-primary">${account.account_type ? account.account_type.replace('-', ' ') : 'N/A'}</span></td>
                    <td>${account.initial_deposit ? Number(account.initial_deposit).toLocaleString() : 'N/A'}</td>
                    <td>${account.occupation || 'N/A'}</td>
                    <td><span class="badge bg-${getStatusColor(account.status)}">${account.status}</span></td>
                    <td>${new Date(account.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
            
            // Initialize search counter
            const counter = document.querySelector('#accounts-counter');
            if (counter) {
                counter.textContent = `${accounts.length} total records`;
            }
        }

        function displayContacts(contacts) {
            const container = document.getElementById('contacts-table');
            const loading = document.getElementById('contacts-loading');
            const content = document.getElementById('contacts-content');
            const empty = document.getElementById('contacts-empty');

            loading.style.display = 'none';

            if (contacts.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = contacts.map(contact => `
                <tr>
                    <td>${contact.name}</td>
                    <td>${contact.email}</td>
                    <td><span class="badge bg-info">${contact.subject ? contact.subject.replace('-', ' ') : 'General'}</span></td>
                    <td>${contact.message.length > 50 ? contact.message.substring(0, 50) + '...' : contact.message}</td>
                    <td><span class="badge bg-${getStatusColor(contact.status)}">${contact.status}</span></td>
                    <td>${new Date(contact.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
            
            // Initialize search counter
            const counter = document.querySelector('#contacts-counter');
            if (counter) {
                counter.textContent = `${contacts.length} total records`;
            }
        }

        function displayLoans(loans) {
            const container = document.getElementById('loans-table');
            const loading = document.getElementById('loans-loading');
            const content = document.getElementById('loans-content');
            const empty = document.getElementById('loans-empty');

            loading.style.display = 'none';

            if (loans.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = loans.map(loan => `
                <tr>
                    <td>${loan.full_name}</td>
                    <td>${loan.email}</td>
                    <td>${Number(loan.amount).toLocaleString()}</td>
                    <td>${loan.purpose}</td>
                    <td><span class="badge bg-${getStatusColor(loan.status)}">${loan.status}</span></td>
                    <td>${new Date(loan.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
            
            // Initialize search counter
            const counter = document.querySelector('#loans-counter');
            if (counter) {
                counter.textContent = `${loans.length} total records`;
            }
        }

        function displayInvestments(investments) {
            const container = document.getElementById('investments-table');
            const loading = document.getElementById('investments-loading');
            const content = document.getElementById('investments-content');
            const empty = document.getElementById('investments-empty');

            loading.style.display = 'none';

            if (investments.length === 0) {
                empty.style.display = 'block';
                return;
            }

            content.style.display = 'block';
            container.innerHTML = investments.map(investment => `
                <tr>
                    <td>${investment.full_name}</td>
                    <td>${investment.email}</td>
                    <td><span class="badge bg-info">${investment.investment_type ? investment.investment_type.replace('-', ' ') : 'N/A'}</span></td>
                    <td>${Number(investment.amount).toLocaleString()}</td>
                    <td>${investment.duration ? investment.duration.replace('-', ' ') : 'N/A'}</td>
                    <td><span class="badge bg-${getStatusColor(investment.status)}">${investment.status}</span></td>
                    <td>${new Date(investment.created_at).toLocaleDateString()}</td>
                </tr>
            `).join('');
            
            // Initialize search counter
            const counter = document.querySelector('#investments-counter');
            if (counter) {
                counter.textContent = `${investments.length} total records`;
            }
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'approved': return 'success';
                case 'rejected': return 'danger';
                case 'new': return 'primary';
                case 'in-progress': return 'info';
                case 'resolved': return 'success';
                default: return 'secondary';
            }
        }

        // Website Analytics Data
        let analyticsData = {
            totalVisits: 0,
            uniqueVisitors: 0,
            pageViews: 0,
            avgSessionTime: 0,
            conversionRate: 0,
            topPage: 'Home',
            recentActivity: [],
            trafficSources: {
                direct: 60,
                google: 25,
                social: 10,
                referral: 5
            }
        };

        // Load analytics data from localStorage or generate sample data
        function loadAnalyticsData() {
            const saved = localStorage.getItem('platinum-mfb-analytics');
            if (saved) {
                analyticsData = { ...analyticsData, ...JSON.parse(saved) };
            } else {
                // Generate sample data
                analyticsData.totalVisits = Math.floor(Math.random() * 1000) + 500;
                analyticsData.uniqueVisitors = Math.floor(analyticsData.totalVisits * 0.7);
                analyticsData.pageViews = Math.floor(Math.random() * 200) + 100;
                analyticsData.avgSessionTime = Math.floor(Math.random() * 300) + 120; // seconds
                analyticsData.conversionRate = ((Math.random() * 5) + 2).toFixed(1);
                
                // Generate recent activity
                const activities = [
                    'New account application submitted',
                    'Contact form message received',
                    'Loan application processed',
                    'Investment inquiry received',
                    'Website visit from Google',
                    'Page view on services page',
                    'Mobile device visit detected'
                ];
                
                analyticsData.recentActivity = [];
                for (let i = 0; i < 7; i++) {
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    const time = new Date(Date.now() - (i * 24 * 60 * 60 * 1000));
                    analyticsData.recentActivity.push({
                        text: activity,
                        time: time.toLocaleDateString(),
                        type: Math.random() > 0.5 ? 'success' : 'info'
                    });
                }
                
                // Save to localStorage
                localStorage.setItem('platinum-mfb-analytics', JSON.stringify(analyticsData));
            }
        }

        // Update analytics display
        function updateAnalytics() {
            document.getElementById('total-visits').textContent = analyticsData.totalVisits.toLocaleString();
            document.getElementById('unique-visitors').textContent = analyticsData.uniqueVisitors.toLocaleString();
            document.getElementById('page-views').textContent = analyticsData.pageViews.toLocaleString();
            document.getElementById('avg-session-time').textContent = Math.floor(analyticsData.avgSessionTime / 60) + 'm ' + (analyticsData.avgSessionTime % 60) + 's';
            document.getElementById('conversion-rate').textContent = analyticsData.conversionRate + '%';
            document.getElementById('top-page').textContent = analyticsData.topPage;
            
            // Update recent activity
            const activityContainer = document.getElementById('recent-activity');
            activityContainer.innerHTML = analyticsData.recentActivity.map(activity => `
                <div class="activity-item">
                    <i class="fas fa-circle text-${activity.type}"></i>
                    <span>${activity.text} - ${activity.time}</span>
                </div>
            `).join('');
            
            // Update traffic sources
            const trafficContainer = document.getElementById('traffic-sources');
            trafficContainer.innerHTML = `
                <div class="traffic-item">
                    <span class="traffic-label">Direct</span>
                    <div class="progress">
                        <div class="progress-bar bg-primary" style="width: ${analyticsData.trafficSources.direct}%">${analyticsData.trafficSources.direct}%</div>
                    </div>
                </div>
                <div class="traffic-item">
                    <span class="traffic-label">Google</span>
                    <div class="progress">
                        <div class="progress-bar bg-success" style="width: ${analyticsData.trafficSources.google}%">${analyticsData.trafficSources.google}%</div>
                    </div>
                </div>
                <div class="traffic-item">
                    <span class="traffic-label">Social Media</span>
                    <div class="progress">
                        <div class="progress-bar bg-info" style="width: ${analyticsData.trafficSources.social}%">${analyticsData.trafficSources.social}%</div>
                    </div>
                </div>
                <div class="traffic-item">
                    <span class="traffic-label">Referral</span>
                    <div class="progress">
                        <div class="progress-bar bg-warning" style="width: ${analyticsData.trafficSources.referral}%">${analyticsData.trafficSources.referral}%</div>
                    </div>
                </div>
            `;
        }

        // Track a new visit
        function trackVisit() {
            analyticsData.totalVisits++;
            analyticsData.pageViews++;
            
            // Update conversion rate based on form submissions
            const totalSubmissions = parseInt(document.getElementById('accounts-count').textContent || '0') +
                                   parseInt(document.getElementById('contacts-count').textContent || '0') +
                                   parseInt(document.getElementById('loans-count').textContent || '0') +
                                   parseInt(document.getElementById('investments-count').textContent || '0');
            
            analyticsData.conversionRate = ((totalSubmissions / analyticsData.totalVisits) * 100).toFixed(1);
            
            // Add new activity
            const newActivity = {
                text: 'New website visit',
                time: new Date().toLocaleDateString(),
                type: 'info'
            };
            analyticsData.recentActivity.unshift(newActivity);
            analyticsData.recentActivity = analyticsData.recentActivity.slice(0, 7); // Keep only last 7
            
            // Save to localStorage
            localStorage.setItem('platinum-mfb-analytics', JSON.stringify(analyticsData));
            
            updateAnalytics();
        }

        function updateStats() {
            const accountsCount = document.querySelectorAll('#accounts-table tr').length;
            const contactsCount = document.querySelectorAll('#contacts-table tr').length;
            const loansCount = document.querySelectorAll('#loans-table tr').length;
            const investmentsCount = document.querySelectorAll('#investments-table tr').length;

            document.getElementById('accounts-count').textContent = accountsCount;
            document.getElementById('contacts-count').textContent = contactsCount;
            document.getElementById('loans-count').textContent = loansCount;
            document.getElementById('investments-count').textContent = investmentsCount;
            
            // Update analytics when stats change
            updateAnalytics();
        }

        function refreshData() {
            // Add loading animation to refresh button
            const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Refreshing...';
            refreshBtn.disabled = true;
            
            // Reset all loading states
            document.getElementById('accounts-loading').style.display = 'block';
            document.getElementById('contacts-loading').style.display = 'block';
            document.getElementById('loans-loading').style.display = 'block';
            document.getElementById('investments-loading').style.display = 'block';
            
            document.getElementById('accounts-content').style.display = 'none';
            document.getElementById('contacts-content').style.display = 'none';
            document.getElementById('loans-content').style.display = 'none';
            document.getElementById('investments-content').style.display = 'none';
            
            document.getElementById('accounts-empty').style.display = 'none';
            document.getElementById('contacts-empty').style.display = 'none';
            document.getElementById('loans-empty').style.display = 'none';
            document.getElementById('investments-empty').style.display = 'none';

            loadAllData().finally(() => {
                // Reset button after loading
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            });
        }
        
        function exportData() {
            try {
                // Collect all data
                const accountsData = Array.from(document.querySelectorAll('#accounts-table tbody tr')).map(row => {
                    const cells = row.querySelectorAll('td');
                    return {
                        name: cells[0]?.textContent || '',
                        email: cells[1]?.textContent || '',
                        phone: cells[2]?.textContent || '',
                        accountType: cells[3]?.textContent || '',
                        initialDeposit: cells[4]?.textContent || '',
                        occupation: cells[5]?.textContent || '',
                        status: cells[6]?.textContent || '',
                        date: cells[7]?.textContent || ''
                    };
                });
                
                const contactsData = Array.from(document.querySelectorAll('#contacts-table tbody tr')).map(row => {
                    const cells = row.querySelectorAll('td');
                    return {
                        name: cells[0]?.textContent || '',
                        email: cells[1]?.textContent || '',
                        subject: cells[2]?.textContent || '',
                        message: cells[3]?.textContent || '',
                        status: cells[4]?.textContent || '',
                        date: cells[5]?.textContent || ''
                    };
                });
                
                // Create CSV content
                const csvContent = 'data:text/csv;charset=utf-8,' + 
                    'Account Applications\n' +
                    'Name,Email,Phone,Account Type,Initial Deposit,Occupation,Status,Date\n' +
                    accountsData.map(row => Object.values(row).join(',')).join('\n') +
                    '\n\nContact Messages\n' +
                    'Name,Email,Subject,Message,Status,Date\n' +
                    contactsData.map(row => Object.values(row).join(',')).join('\n');
                
                // Create and download file
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', `platinum-mfb-data-${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Show success message
                showNotification('Data exported successfully!', 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Export failed. Please try again.', 'error');
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // New enhanced functions
        let autoRefreshInterval = null;
        let isAutoRefreshEnabled = false;

        function toggleAutoRefresh() {
            const btn = document.getElementById('auto-refresh-btn');
            const icon = btn.querySelector('i');
            
            if (isAutoRefreshEnabled) {
                clearInterval(autoRefreshInterval);
                icon.className = 'fas fa-play';
                btn.title = 'Enable Auto-Refresh';
                isAutoRefreshEnabled = false;
                showNotification('Auto-refresh disabled', 'info');
            } else {
                autoRefreshInterval = setInterval(refreshData, 30000); // Refresh every 30 seconds
                icon.className = 'fas fa-pause';
                btn.title = 'Disable Auto-Refresh';
                isAutoRefreshEnabled = true;
                showNotification('Auto-refresh enabled (30s intervals)', 'success');
            }
        }

        function showSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Admin Settings</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Auto-refresh Interval (seconds)</label>
                                <input type="number" class="form-control" id="refresh-interval" value="30" min="10" max="300">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Data Export Format</label>
                                <select class="form-select" id="export-format">
                                    <option value="csv">CSV</option>
                                    <option value="json">JSON</option>
                                    <option value="xlsx">Excel</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="show-timestamps" checked>
                                    <label class="form-check-label" for="show-timestamps">
                                        Show detailed timestamps
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable-notifications" checked>
                                    <label class="form-check-label" for="enable-notifications">
                                        Enable desktop notifications
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(modal);
            });
        }

        function saveSettings() {
            const interval = document.getElementById('refresh-interval').value;
            const format = document.getElementById('export-format').value;
            const timestamps = document.getElementById('show-timestamps').checked;
            const notifications = document.getElementById('enable-notifications').checked;
            
            // Save settings to localStorage
            const settings = {
                refreshInterval: interval,
                exportFormat: format,
                showTimestamps: timestamps,
                enableNotifications: notifications
            };
            localStorage.setItem('platinum-mfb-settings', JSON.stringify(settings));
            
            // Update auto-refresh interval if enabled
            if (isAutoRefreshEnabled) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = setInterval(refreshData, interval * 1000);
            }
            
            showNotification('Settings saved successfully!', 'success');
            bootstrap.Modal.getInstance(document.querySelector('.modal')).hide();
        }

        function showSystemLogs() {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">System Logs</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="filterLogs('all')">All</button>
                                    <button type="button" class="btn btn-outline-success btn-sm" onclick="filterLogs('success')">Success</button>
                                    <button type="button" class="btn btn-outline-warning btn-sm" onclick="filterLogs('warning')">Warning</button>
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="filterLogs('error')">Error</button>
                                </div>
                            </div>
                            <div id="logs-container" style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border-radius: 5px; font-family: monospace; font-size: 0.9rem;">
                                <div class="text-success">[${new Date().toISOString()}] System initialized successfully</div>
                                <div class="text-info">[${new Date().toISOString()}] Admin dashboard loaded</div>
                                <div class="text-info">[${new Date().toISOString()}] Data refresh completed</div>
                                <div class="text-warning">[${new Date().toISOString()}] API response time: 1.2s</div>
                                <div class="text-success">[${new Date().toISOString()}] All systems operational</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="clearLogs()">Clear Logs</button>
                            <button type="button" class="btn btn-primary" onclick="downloadLogs()">Download Logs</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(modal);
            });
        }

        function updateLastUpdatedTime() {
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleTimeString();
        }

        function performHealthCheck() {
            // Simulate health check
            const healthCheckTime = document.getElementById('health-check-time');
            healthCheckTime.textContent = new Date().toLocaleTimeString();
            
            // Update system status indicators
            const indicators = ['db-status', 'api-status', 'uptime-status', 'security-status'];
            indicators.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.className = 'badge bg-success';
                }
            });
        }

        // Enhanced initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Initial setup
            updateLastUpdatedTime();
            performHealthCheck();
            
            // Load settings
            const savedSettings = localStorage.getItem('platinum-mfb-settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                // Apply saved settings
            }
            
            // Start periodic health checks
            setInterval(performHealthCheck, 60000); // Every minute
            setInterval(updateLastUpdatedTime, 30000); // Every 30 seconds
            
            // Check authentication status
            checkAuthStatus();
        });
    </script>
</body>
</html>
